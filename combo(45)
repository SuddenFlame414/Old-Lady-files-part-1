YUI.add("flickr-notifications-markread-updater",function(r,i){"use strict";r.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:function(e,a){return a.callAPI("flickr.notifications.markread",e).then(null,r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-getNotificationsCount-fetcher",function(t,i){"use strict";t.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:function(e,o){var n=this;return t.FlickrPromise({apiResponse:o.callAPI("flickr.activity.getNotificationsCount",e),personNotifsModelRegistry:o.getModelRegistry("person-notifications-models")}).then(function(t){return n._processResponse(t,o,e)},t.FetcherErrorLogger(i))},_processResponse:function(t,i,e){var o=t.apiResponse;return t.personNotifsModelRegistry.setValue(e.id,"unseenNotificationCount",o.activity.count),o.activity.count}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});YUI.add("flickr-activity-muteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-muteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.muteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-unmuteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-unmuteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.unmuteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("person-notifications-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-getInfo"].run(e,this.appContext)},readUnseenNotificationCount:function(e,r){return t.ModelFetchers["flickr-activity-getNotificationsCount"].run(e,r)},updateMutedObjects:function(e,r){return t.ModelUpdaters["flickr-activity-muteObject"].run(e,r)},updateUnmutedObjects:function(e,r){return t.ModelUpdaters["flickr-activity-unmuteObject"].run(e,r)}},remoteReadUnseenNotificationCount:function(t,e,r){return this.setValue(t,"unseenLastFetchedTimestamp",Date.now()),this.remote.readUnseenNotificationCount(e,r)},remoteUpdateMutedObjects:function(t,e,r){var n=this;return this.remote.updateMutedObjects(e,r).then(function(e){return n.setValue(t,"muteChanged",!0),e})},remoteUpdateUnmutedObjects:function(t,e,r){var n=this;return this.remote.updateUnmutedObjects(e,r).then(function(e){return n.setValue(t,"muteChanged",!0),e})},getNotificationsByContinuation:function(e,r){return t.ListFetchers["flickr-activity-recentByType"].run({id:e,page:r.page,perPage:r.perPage},this.appContext)},attributes:{id:{setter:function(t){return t||this.appContext.getViewer().nsid}},unseenNotificationCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unreadFlickrMailCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenLastFetchedTimestamp:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},muteChanged:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},notifications:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-activity-recentByType-OLD"]}},notificationsContinuated:{},continuation:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:"0"}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-activity-recentByType-OLD-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","flickr-activity-getNotificationsCount-fetcher","flickr-activity-muteObject-updater","flickr-activity-unmuteObject-updater","attribute-helpers"]});YUI.add("flickr-activity-recentByType-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-activity-recentByType"]={run:function(i,s){var n=this,r=this._processParams(i);return new e.FlickrPromise({apiResponse:s.callAPI("flickr.activity.recentByType",r),notificationModelRegistry:s.getModelRegistry("notification-models"),notificationsModelRegistry:s.getModelRegistry("person-notifications-models")}).then(function(e){return n._processResponse(e,i,r,s)},e.FetcherErrorLogger(t))},_processParams:function(t){var i,s={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||30,count:30,page:t.page||1,per_object:50};return i=e.merge(s,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(i),i},_processResponse:function(t,i,s,n){var r=t.apiResponse,a=t.notificationModelRegistry,o=t.notificationsModelRegistry,c=[],p=new e.NotificationsHelper(n);return r.items.item.forEach(function(t){var i=t.activity?t.activity.event:[],s={id:e.guid(),isSeen:1===t.seen||!0===t.seen,isMuted:1===t.is_muted,type:t.type,timestamp:t.date,activityData:t,eventDataList:i};c.push(p.extractEntitiesFromResponse(s).then(function(s){var n={id:e.guid(),isSeen:1===t.seen||!0===t.seen,isMuted:1===t.is_muted,type:t.type,timestamp:t.date,activityData:t,eventDataList:i,activityEntityModel:s.activityEntityModel,eventEntityModels:s.eventEntityModels};return a.addOrUpdate(n)}))}),e.Promise.all(c).then(function(e){var t={id:i.id,notifications:e};return o.exists(i.id)?o.getValue(i.id,"notifications").addPage({page:s.page,perPage:s.per_page,pageContent:e,totalItems:parseInt(r.items.total||0,10)}):o.add(t),e})}}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-models","person-notifications-models","contact-models","photo-models","notification-models"]});