YUI.add("hermes-template-notif-item-photo-accepted",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var p,l,s=e.escapeExpression;return'<div class="notification-item notif-item-photo-accepted">\n\t<span class="notification-type">NotificationType: '+s("function"==typeof(l=null!=(l=a.type||(null!=t?t.type:t))?l:a.helperMissing)?l.call(null!=t?t:{},{name:"type",hash:{},data:n}):l)+'</span>\n\t<div class="entity-type">ObjectType: '+s(e.lambda(null!=(p=null!=t?t.activityData:t)?p.objectType:p,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-photo-accepted",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notif-item-photo-declined",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,p=e.escapeExpression;return'<div class="notification-item notif-item-photo-declined">\n\t<span class="notification-type">NotificationType: '+p("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+p(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-photo-declined",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notif-item-photo-mention",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,i){var l,o,s=e.escapeExpression;return'<div class="notification-item notif-item-photo-mention">\n\t<span class="notification-type">NotificationType: '+s("function"==typeof(o=null!=(o=a.type||(null!=t?t.type:t))?o:a.helperMissing)?o.call(null!=t?t:{},{name:"type",hash:{},data:i}):o)+'</span>\n\t<div class="entity-type">ObjectType: '+s(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/notif-item-photo-mention",function(t,i){return i=i||{},i.partials=i.partials?e.merge(n,i.partials):n,a(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notif-item-group-blast",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,r=e.escapeExpression;return'<div class="notification-item notif-item-group-blast">\n\t<span class="notification-type">NotificationType: '+r("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+r(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-group-blast",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notif-item-upload",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,p=e.escapeExpression;return'<div class="notification-item notif-item-upload">\n\t<span class="notification-type">NotificationType: '+p("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+p(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-upload",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("notifications-helper",function(e,t){require("hermes-core/flog")(t);var i=e.mix({langBundles:["notifications","relative-dates"]},e.Localizable),o={fave:"notif-item-fave",comment:"notif-item-comment",reply_reply:"notif-item-reply-reply",group_topic_new:"notif-item-group-topic-new",contacted:"notif-item-contacted",group_invite:"notif-item-group-invite",note:"notif-item-note",tag:"notif-item-tag",people:"notif-item-people",testimonial:"notif-item-testimonial",group_user_invite:"notif-item-group-user-invite",flickrmail:"notif-item-flickrmail",photo_comment_mention:"notif-item-photo-comment-mention",gallery:"notif-item-gallery",gallery_comment:"notif-item-gallery-comment",share:"notif-item-share",photo_accepted:"notif-item-photo-accepted",photo_declined:"notif-item-photo-declined",photo_mention:"notif-item-photo-mention",group_blast:"notif-item-group-blast",upload:"notif-item-upload"},n=50;e.NotificationsHelper=function(t,a){function r(e){var t=e.getSizeToFit({width:n,height:n},{sizes:e.getValue("sizes"),cropToFit:!0,includeSquare:!0});return{id:e.getValue("id"),url:e.getValue("url"),displayUrl:t.displayUrl}}function l(t,i){var o,n=[],a=[];return i=i||t.eventDataList[0].objectType,n.push(p[t.activityData.objectType].extractEntityModel(t.activityData).then(function(e){o=e})),t.eventDataList.forEach(function(e){n.push(p[i].extractEntityModel(e).then(function(e){a.push(e)}))}),e.Promise.all(n).then(function(){return{activityEntityModel:o,eventEntityModels:a}})}var s,p,m=new e.TemplateLibraryHelper(t,{localizeLib:i});p={photo:{extractEntityModel:function(i){return e.FlickrPromise({photoModelRegistry:t.getModelRegistry("photo-models"),personModelRegistry:t.getModelRegistry("person-models"),photoEngagementModelRegistry:t.getModelRegistry("photo-engagement-models"),photoStatsRegistry:t.getModelRegistry("photo-stats-models")}).then(function(t){var o=e.clone(i);if(o.title){var n=o.title.content||o.title._content;o.title=n}return e.APIHelper.response.parsePhotos({photos:[o],photoModelRegistry:t.photoModelRegistry,personModelRegistry:t.personModelRegistry,photoEngagementModelRegistry:t.photoEngagementModelRegistry,photoStatsModelRegistry:t.photoStatsRegistry}).shift()})}},set:{extractEntityModel:function(e){return e}},gallery:{extractEntityModel:function(i){return e.FlickrPromise({galleryModelRegistry:t.getModelRegistry("notification-gallery-models")}).then(function(e){return e.galleryModelRegistry.addOrUpdate(e.galleryModelRegistry.parseGalleryModel(i))})}},person:{extractEntityModel:function(i){return e.FlickrPromise({personModelRegistry:t.getModelRegistry("person-models")}).then(function(t){return i.iconurls||console.log("no icon urls"),t.personModelRegistry.addOrUpdate(e.APIHelper.response.parsePerson({nsid:i.user,pathAlias:i.pathAlias,username:i.username,realname:i.realname,isAdFree:i.isAdFree,ispro:i.ispro,proBadge:i.proBadge,datecreate:i.datecreate,iconurls:i.iconurls}))})}},flickrmail:{extractEntityModel:function(i){return e.FlickrPromise({flickrMailModelRegistry:t.getModelRegistry("notification-flickrmail-models")}).then(function(e){return e.flickrMailModelRegistry.addOrUpdate(e.flickrMailModelRegistry.parseFlickrMailModel(i))})}},group:{extractEntityModel:function(i){return e.FlickrPromise({groupModelRegistry:t.getModelRegistry("group-models")}).then(function(e){return e.groupModelRegistry.addOrUpdate(e.groupModelRegistry.parseGroupModel(i.id,i.pathAlias,i))})}},discussion:{extractEntityModel:function(i){return e.FlickrPromise({groupModelRegistry:t.getModelRegistry("group-models"),discussionModelRegistry:t.getModelRegistry("notification-group-discussion-models")}).then(function(t){var o,n;return n=e.clone(i),n.id=i.group_id,n.title=i.group_name,o=t.groupModelRegistry.addOrUpdate(t.groupModelRegistry.parseGroupModel(i.group_id,i.pathAlias,n)),t.discussionModelRegistry.add(t.discussionModelRegistry.parseDiscussionModel(i.id,i.pathAlias,i,o))})}},testimonial:{extractEntityModel:function(e){return e}}},s={fave:{extractEntitiesFromResponse:function(e){return l(e,"person"===e.activityData.objectType?"photo":"person").catch(function(e){console.log(e)})},constructTemplateConfig:function(o){var n;if("person"===o.activityData.objectType){var a=o.activityEntityModel,l=o.eventEntityModels;return n=i.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_X_PHOTOS",personName:a.getValue("displayname"),personUrl:a.getValue("url"),photoCountString:o.eventEntityModels.length,mediaType:l[0].getValue("mediaType")}),{headline:n,timestamp:o.timestamp,avatarData:{id:a.getValue("id"),type:o.activityData.objectType,iconUrl:a.getValue("buddyicon").small,url:a.getValue("url")},photos:l.map(function(e){return r(e)}).slice(0,12),hasMultiplePhotos:l.length>1}}if("photo"===o.activityData.objectType){var s=o.activityEntityModel,p=o.eventEntityModels;return n=p.length>1?i.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_FAVED_1_PHOTO",personName:p[0].getValue("displayname"),personUrl:p[0].getValue("url"),personCountString:e.IntlNumber.format(p.length,t.lang,1),photoTitle:s.getValue("title"),photoUrl:s.getValue("url")}):i.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_1_PHOTO",personName:p[0].getValue("displayname"),personUrl:p[0].getValue("url"),photoTitle:s.getValue("title"),photoUrl:s.getValue("url")}),{headline:n,timestamp:o.timestamp,avatarData:{id:p[0].getValue("id"),type:"person",iconUrl:p[0].getValue("buddyicon").small,url:p[0].getValue("url")},photo:r(s)}}}},comment:{extractEntitiesFromResponse:function(e){return l(e,"person"===e.activityData.objectType?"photo":"person")},constructTemplateConfig:function(o){var n;if("person"===o.activityData.objectType){var a=o.activityEntityModel,l=o.eventEntityModels;return n=i.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_X_PHOTOS",personName:a.getValue("displayname"),personUrl:a.getValue("url"),photoCountString:o.eventEntityModels.length,mediaType:l[0].getValue("mediaType")}),{headline:n,timestamp:o.timestamp,avatarData:{id:a.getValue("id"),type:o.activityData.objectType,iconUrl:a.getValue("buddyicon").small,url:a.getValue("url")},photos:l.map(function(e){return r(e)}).slice(0,12),hasMultiplePhotos:l.length>1}}if("photo"===o.activityData.objectType){var s=o.activityEntityModel,p=o.eventEntityModels;return n=p.length>1?i.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENTED_1_PHOTO",personName:p[0].getValue("displayname"),personUrl:p[0].getValue("url"),personCountString:e.IntlNumber.format(p.length,t.lang,1),photoTitle:s.getValue("title"),photoUrl:s.getValue("url")}):i.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_1_PHOTO",personName:p[0].getValue("displayname"),personUrl:p[0].getValue("url"),commentUrl:s.getValue("url")+"/#comment"+o.eventDataList[0].commentid,commentContent:o.eventDataList[0]._content}),{headline:n,timestamp:o.timestamp,avatarData:{id:p[0].getValue("id"),type:"person",iconUrl:p[0].getValue("buddyicon").small,url:p[0].getValue("url")},photo:r(s)}}}},reply_reply:{},group_topic_new:{},contacted:{},group_invite:{},note:{},tag:{},people:{},testimonial:{},group_user_invite:{},flickrmail:{},photo_comment_mention:{},gallery:{},gallery_comment:{},share:{},photo_accepted:{},photo_declined:{},photo_mention:{},group_blast:{},upload:{}};var u={extractEntitiesFromResponse:function(t){try{return s[t.type].extractEntitiesFromResponse(t)}catch(t){return e.Promise.resolve({})}},getTemplateHtml:function(e){var t,i=e.type;try{return t=s[i].constructTemplateConfig(e),m.getTemplate(o[i])(t)}catch(e){return""}},convertNotificationModel:function(e){return{id:e.getValue("id"),seen:e.getValue("isSeen"),isMuted:e.getValue("isMuted"),type:e.getValue("type"),timestamp:e.getValue("timestamp"),model:e,activityData:e.getValue("activityData"),eventDataList:e.getValue("eventDataList"),activityEntityModel:e.getValue("activityEntityModel"),eventEntityModels:e.getValue("eventEntityModels")}}};return e.augment(u,e.EventTarget),u}},"@VERSION@",{requires:["event-custom","template-lib-helper","api-helper","intl-number","hermes-template-notification-core","hermes-template-notif-item-fave","hermes-template-notif-item-comment","hermes-template-notif-item-reply-reply","hermes-template-notif-item-group-topic-new","hermes-template-notif-item-contacted","hermes-template-notif-item-group-invite","hermes-template-notif-item-note","hermes-template-notif-item-tag","hermes-template-notif-item-people","hermes-template-notif-item-testimonial","hermes-template-notif-item-group-user-invite","hermes-template-notif-item-flickrmail","hermes-template-notif-item-photo-comment-mention","hermes-template-notif-item-gallery","hermes-template-notif-item-gallery-comment","hermes-template-notif-item-share","hermes-template-notif-item-photo-accepted","hermes-template-notif-item-photo-declined","hermes-template-notif-item-photo-mention","hermes-template-notif-item-group-blast","hermes-template-notif-item-upload"],langBundles:["common","relative-dates","notifications"]});